"use strict";(self.webpackChunknantralplatform_docs=self.webpackChunknantralplatform_docs||[]).push([[97],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),m=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=m(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),d=m(a),u=i,h=d["".concat(s,".").concat(u)]||d[u]||c[u]||o;return a?n.createElement(h,l(l({ref:t},p),{},{components:a})):n.createElement(h,l({ref:t},p))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,l=new Array(o);l[0]=u;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[d]="string"==typeof e?e:i,l[1]=r;for(var m=2;m<o;m++)l[m]=a[m];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5982:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>m});var n=a(7462),i=(a(7294),a(3905));const o={title:"Send Emails",sidebar_position:2,last_update:{date:"2024-01-30 12:11:39 -0500",author:"Corentin09"}},l="How to send emails?",r={unversionedId:"dev/advanced-guides/emails",id:"dev/advanced-guides/emails",title:"Send Emails",description:"This guide describe how to send emails from the Nantral Platform website.",source:"@site/docs/dev/advanced-guides/emails.md",sourceDirName:"dev/advanced-guides",slug:"/dev/advanced-guides/emails",permalink:"/dev/advanced-guides/emails",draft:!1,editUrl:"https://github.com/3cn-ecn/nantralPlatform/tree/master/docs/docs/dev/advanced-guides/emails.md",tags:[],version:"current",lastUpdatedBy:"Corentin09",lastUpdatedAt:1706634699,formattedLastUpdatedAt:"Jan 30, 2024",sidebarPosition:2,frontMatter:{title:"Send Emails",sidebar_position:2,last_update:{date:"2024-01-30 12:11:39 -0500",author:"Corentin09"}},sidebar:"sidebar",previous:{title:"Database",permalink:"/dev/advanced-guides/database/"},next:{title:"Staging Server",permalink:"/dev/advanced-guides/staging-server/"}},s={},m=[{value:"1\ufe0f\u20e3 Create your email template",id:"1\ufe0f\u20e3-create-your-email-template",level:2},{value:"2\ufe0f\u20e3 Send your email from Django",id:"2\ufe0f\u20e3-send-your-email-from-django",level:2},{value:"3\ufe0f\u20e3 Passing context data from django to the email template",id:"3\ufe0f\u20e3-passing-context-data-from-django-to-the-email-template",level:2},{value:"4\ufe0f\u20e3 Test your email",id:"4\ufe0f\u20e3-test-your-email",level:2},{value:"\ud83d\udedf F.A.Q.",id:"-faq",level:2},{value:"Can I send an email from the React frontend?",id:"can-i-send-an-email-from-the-react-frontend",level:3},{value:"The backend crashes when I try to send an email",id:"the-backend-crashes-when-i-try-to-send-an-email",level:3}],p={toc:m},d="wrapper";function c(e){let{components:t,...a}=e;return(0,i.kt)(d,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-send-emails"},"How to send emails?"),(0,i.kt)("p",null,"This guide describe how to send emails from the Nantral Platform website."),(0,i.kt)("h2",{id:"1\ufe0f\u20e3-create-your-email-template"},"1\ufe0f\u20e3 Create your email template"),(0,i.kt)("p",null,"First, create your email template with ",(0,i.kt)("a",{parentName:"p",href:"https://react.email/docs/introduction"},"react-email"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Go into the ",(0,i.kt)("inlineCode",{parentName:"p"},"email-templates-generator")," folder:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd email-templates-generator\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Start the preview server (this is not required, but it is very helpful):"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm run start\n")),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},"You can preview your email at ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:3000"},"http://localhost:3000")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Create a new email template in the ",(0,i.kt)("inlineCode",{parentName:"p"},"emails")," folder, by copying an existing\ntemplate (for example at the moment we have ",(0,i.kt)("inlineCode",{parentName:"p"},"email-confirmation.tsx")," and\n",(0,i.kt)("inlineCode",{parentName:"p"},"reset-password.tsx"),"), and edit it to your liking!"),(0,i.kt)("admonition",{parentName:"li",type:"success"},(0,i.kt)("p",{parentName:"admonition"},"You can check ",(0,i.kt)("a",{parentName:"p",href:"https://react.email/docs/introduction"},"the documentation")," to\nknow the available components. Do not use standard HTML tags!"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Once you're happy with the result, compile the template to an HTML file:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\n")),(0,i.kt)("admonition",{parentName:"li",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"build")," command creates 2 files: an HTML file and TXT file. This is\nbecause we need to send them both in an email, given that some email client\ndo not support HTML emails.\nThese 2 files are created in the ",(0,i.kt)("inlineCode",{parentName:"p"},"backend/templates/emails")," folder.")))),(0,i.kt)("h2",{id:"2\ufe0f\u20e3-send-your-email-from-django"},"2\ufe0f\u20e3 Send your email from Django"),(0,i.kt)("p",null,"To send the email from the backend, you need to call this function\nfrom ",(0,i.kt)("inlineCode",{parentName:"p"},"backend/apps/utils/send_email.py"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"def send_email(\n    subject: str,  # The subject of the email\n    to: str,  # The email address of the recipient\n    template_name: str,  # The name of the template\n    context: Optional[dict[str, Any]] = None,  # The context object\n) -> int:\n")),(0,i.kt)("p",null,"For example, if we call:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'send_email(\n  subject="Hello world",\n  to="toto@example.org",\n  template_name="email-confirmation",\n)\n')),(0,i.kt)("p",null,"This will send an email to ",(0,i.kt)("inlineCode",{parentName:"p"},"toto@example.org")," with the subject ",(0,i.kt)("inlineCode",{parentName:"p"},'"Hello world"'),",\nand the content of the email will be the template file located in\n",(0,i.kt)("inlineCode",{parentName:"p"},"email-templates-generator/emails/email-confirmation.tsx"),". The email will be\nsent from the address ",(0,i.kt)("inlineCode",{parentName:"p"},"no-reply@nantral-platform.fr"),". The function then\nreturns 0 if the email was sent successfully, or 1 if an error occurred."),(0,i.kt)("p",null,"If you want to send an email to multiple users at the same time, you can\nuse the function ",(0,i.kt)("inlineCode",{parentName:"p"},"send_mass_email")," from the same file."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"In order to avoid being flagged as SPAM, we should avoid sending more than 30-50 emails at once, especially to ",(0,i.kt)("inlineCode",{parentName:"p"},"@ec-nantes.fr"),", which is more restrictive than big email providers such as Google.")),(0,i.kt)("h2",{id:"3\ufe0f\u20e3-passing-context-data-from-django-to-the-email-template"},"3\ufe0f\u20e3 Passing context data from django to the email template"),(0,i.kt)("p",null,"If you want to customize your template for the user to which you send the mail,\nyou can pass some context data to the template."),(0,i.kt)("p",null,"Here is a quick start example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="email-templates-generator/emails/example-email.tsx"',title:'"email-templates-generator/emails/example-email.tsx"'},'type Props = {\n  firstName?: string;\n  validationLink?: string;\n};\nconst ActivateYourAccountEmail = ({\n  firstName = "{{first_name|title}}",\n  validationLink = "{{validation_link}}",\n}: Props) => (\n  <Html>\n    <Text>Bonjour {firstName} !</Text>\n    <Text>\n      Valide ton compte <Link href={validationLink}>en cliquant ici ici</Link>\n    </Text>\n  </Html>\n);\n')),(0,i.kt)("p",null,"Then, in your python code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'send_email(\n  subject="Hello world",\n  to="toto@example.org",\n  template_name="example-email",\n  context={\n    "first_name": "Toto",\n    "validation_link": "https://nantral-platform.fr/validation/123456789",\n  },\n)\n')),(0,i.kt)("admonition",{title:"Some things to know...",type:"note"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The name of the django context variables must be put in strings, with\ndouble-brackets (",(0,i.kt)("inlineCode",{parentName:"p"},"{{variable_name}}"),"), in the React template. This is because\nthe template with context data is compiled by Django, and not React.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"You can still use django filters and tags in the variable template (for\nexample ",(0,i.kt)("inlineCode",{parentName:"p"},"{{user.first_name|title}}"),").")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If you need to send a link to the website, do not hard-code the domain name\n",(0,i.kt)("inlineCode",{parentName:"p"},"nantral-platform.fr"),": instead, use the django method\n",(0,i.kt)("inlineCode",{parentName:"p"},"request.build_absolute_uri('/some/path')")," to build the URL. This allows us to\nuse the correct domain name in development, staging and production.")))),(0,i.kt)("h2",{id:"4\ufe0f\u20e3-test-your-email"},"4\ufe0f\u20e3 Test your email"),(0,i.kt)("p",null,"We already seen that you can preview your email in the browser, but you must\nhave noticed that this preview does not include the context data."),(0,i.kt)("p",null,"To test your email during runtime, you have 2 options:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Use ",(0,i.kt)("a",{parentName:"p",href:"./docker"},"Docker")," to locally run the server:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Launch the website locally with docker:",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd deployment\ndocker compose build\ndocker compose up\n"))),(0,i.kt)("li",{parentName:"ul"},"Go to ",(0,i.kt)("a",{parentName:"li",href:"http://localhost"},"http://localhost")," and create a new account\n(your local account already created will not work, because you are\nusing a different database in docker-mode)."),(0,i.kt)("li",{parentName:"ul"},"Go to ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:8025"},"http://localhost:8025"),": this is a fake email\nserver that will run locally. All emails sent from django in local with\ndocker should be redirected here. You should also have received the email\nto validate the account created at the previous step.")),(0,i.kt)("p",{parentName:"li"},"\u27a1\ufe0f Find more info on the ",(0,i.kt)("a",{parentName:"p",href:"./docker"},"Docker")," page.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Use the ",(0,i.kt)("a",{parentName:"p",href:"./staging-server"},"Staging Server"),": this method is easier, but be\naware that you will use the real email server, so be sure to not send test\nemails to other users!"))),(0,i.kt)("h2",{id:"-faq"},"\ud83d\udedf F.A.Q."),(0,i.kt)("h3",{id:"can-i-send-an-email-from-the-react-frontend"},"Can I send an email from the React frontend?"),(0,i.kt)("p",null,"No, you can't. If you wish to make this, you need to create an API route in\nDjango that send an email, and then call this route in the React frontend."),(0,i.kt)("h3",{id:"the-backend-crashes-when-i-try-to-send-an-email"},"The backend crashes when I try to send an email"),(0,i.kt)("p",null,"Check that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"you have compiled the email template with ",(0,i.kt)("inlineCode",{parentName:"li"},"npm run build")," (for local dev only,\nthis is done automatically in production)"),(0,i.kt)("li",{parentName:"ul"},"the name of the template in the ",(0,i.kt)("inlineCode",{parentName:"li"},"send_email")," function is correct (you should\nnot include the ",(0,i.kt)("inlineCode",{parentName:"li"},".tsx"),", ",(0,i.kt)("inlineCode",{parentName:"li"},".html"),", or ",(0,i.kt)("inlineCode",{parentName:"li"},".txt")," extension)")))}c.isMDXComponent=!0}}]);