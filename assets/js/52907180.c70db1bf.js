"use strict";(self.webpackChunknantralplatform_docs=self.webpackChunknantralplatform_docs||[]).push([[4389],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),d=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return o.createElement(c.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=d(n),u=r,k=m["".concat(c,".").concat(u)]||m[u]||s[u]||a;return n?o.createElement(k,i(i({ref:t},p),{},{components:n})):o.createElement(k,i({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<a;d++)i[d]=n[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5738:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return u},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return s}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),i=["components"],l={title:"Using Docker",sidebar_position:1},c="Using Docker",d={unversionedId:"docker/using-docker",id:"docker/using-docker",title:"Using Docker",description:"How to run docker for local dev",source:"@site/docs/docker/using-docker.md",sourceDirName:"docker",slug:"/docker/using-docker",permalink:"/docs/docker/using-docker",draft:!1,editUrl:"https://github.com/nantral-platform/nantralPlatform/tree/master/docs/docs/docker/using-docker.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Using Docker",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Docker",permalink:"/docs/category/docker"},next:{title:"Deployment",permalink:"/docs/category/deployment"}},p={},s=[{value:"How to run docker for local dev",id:"how-to-run-docker-for-local-dev",level:2},{value:"How to run docker for production",id:"how-to-run-docker-for-production",level:2}],m={toc:s};function u(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"using-docker"},"Using Docker"),(0,a.kt)("h2",{id:"how-to-run-docker-for-local-dev"},"How to run docker for local dev"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Install docker-desktop from the official website:\n",(0,a.kt)("a",{parentName:"li",href:"https://docs.docker.com/get-docker/"},"docs.docker.com/get-docker")),(0,a.kt)("li",{parentName:"ol"},"Add the ",(0,a.kt)("em",{parentName:"li"},'"docker needed"')," variables in your ",(0,a.kt)("inlineCode",{parentName:"li"},".env")," environment file.\nIt must be at this place: ",(0,a.kt)("inlineCode",{parentName:"li"},"backend/config/settings/.env")),(0,a.kt)("li",{parentName:"ol"},"Go to the ",(0,a.kt)("inlineCode",{parentName:"li"},"deployment")," directory: ",(0,a.kt)("inlineCode",{parentName:"li"},"cd deployment/")),(0,a.kt)("li",{parentName:"ol"},"Create an empty file ",(0,a.kt)("inlineCode",{parentName:"li"},"backend.env")," in this directory"),(0,a.kt)("li",{parentName:"ol"},"Build the containers: ",(0,a.kt)("inlineCode",{parentName:"li"},"docker-compose build")),(0,a.kt)("li",{parentName:"ol"},"Start the services: ",(0,a.kt)("inlineCode",{parentName:"li"},"docker-compose up")),(0,a.kt)("li",{parentName:"ol"},"Try to connect to ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost")," in your browser. ")),(0,a.kt)("p",null,"If you can access the login page, congratulations everything is ok! \ud83e\udd73 "),(0,a.kt)("p",null,"Let's create a superuser account now, so that you can connect. For this, follow the\ntutorial ",(0,a.kt)("a",{parentName:"p",href:"/docs/get-started/setup-django#create-your-account"},"here"),". You only have to replace\nthe command for creating a superuser by:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker-compose exec backend python3 manage.py createsuperuser\n")),(0,a.kt)("p",null,"You can run this command in another terminal (but always in the ",(0,a.kt)("inlineCode",{parentName:"p"},"deployment")," directory)."),(0,a.kt)("div",{className:"admonition admonition-success alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Useful tips")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("ul",{parentName:"div"},(0,a.kt)("li",{parentName:"ul"},"You can stop docker by pressing ",(0,a.kt)("kbd",null,"CTRL"),"+",(0,a.kt)("kbd",null,"C")," in the console if docker\nis running, or by running the command ",(0,a.kt)("inlineCode",{parentName:"li"},"docker-compose down"),"."),(0,a.kt)("li",{parentName:"ul"},"You can also launch docker services in background by adding the\n",(0,a.kt)("inlineCode",{parentName:"li"},"-d")," argument on the up command. "),(0,a.kt)("li",{parentName:"ul"},"If you want to be faster, you can run both command at once by\nusing ",(0,a.kt)("inlineCode",{parentName:"li"},"docker-compose up --build"))))),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),(0,a.kt)("strong",{parentName:"h5"},"What does it do?"))),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"When you run ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose")," without specifying the files to run, it\nruns by default ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," and then ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.override.yml"),".\nIt is equivalent to run:"),(0,a.kt)("pre",{parentName:"div"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose -f docker-compose.yml -f docker-compose.override.yml up --build\n")),(0,a.kt)("p",{parentName:"div"},"In our case, the files are configured to run the backend (with django),\nan instance of postgresql (the database), and the celery services (for\nbackground tasks)."))),(0,a.kt)("h2",{id:"how-to-run-docker-for-production"},"How to run docker for production"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Go to the ",(0,a.kt)("inlineCode",{parentName:"li"},"deployment")," directory."),(0,a.kt)("li",{parentName:"ol"},"Create the environment files at the root of this directory:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"backend.env")," for all environment variables related to django"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mailu.env")," for those related to the mail server"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"wiki.env")," for those related to the wiki"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"frontend.env")," for those related to the react frontend"))),(0,a.kt)("li",{parentName:"ol"},"Build and run the docker-compose files:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose -f docker-compose.yml -f docker-compose.prod.yml up --build -d\n")))),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Note that in practice, we will not stop and restart all services each\ntime we want to make an update. To do so, we can indicate which service\nwe want to restart. For example, to restart only the backend:"),(0,a.kt)("pre",{parentName:"div"},(0,a.kt)("code",{parentName:"pre"},"docker-compose -f docker-compose.yml -f docker-compose.prod.yml build --no-cache nginx backend\ndocker-compose -f docker-compose.yml -f docker-compose.prod.yml up\n")),(0,a.kt)("p",{parentName:"div"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"--no-cache")," option allowed to delete the cache and be sure that\nall files are really updated."))),(0,a.kt)("p",null,"This will run:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"the django server (for the backend)"),(0,a.kt)("li",{parentName:"ul"},"the postgresql server (for the database)"),(0,a.kt)("li",{parentName:"ul"},"the celery tasks"),(0,a.kt)("li",{parentName:"ul"},"the mail server"),(0,a.kt)("li",{parentName:"ul"},"the wiki of nantral platform")))}u.isMDXComponent=!0}}]);