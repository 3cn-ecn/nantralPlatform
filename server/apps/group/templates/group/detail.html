{% extends 'base.html' %}
{% load static %}

{% block content %}
    <br>
    <div class="row">
        {%if object.logo %}
            <div class="col-3">
                <div class="ratio ratio-1x1">
                    <img class="logo" src='{{object.logo.url}}'>
                </div>
            </div>
        {% endif %}
        <div class="col">
            <h1>{{object.name}}</h1>
            <p>
            {% if request.user.is_authenticated %}
                {% if is_member and is_admin %}
                    <button class='btn btn-light btn-sm disabled'>
                        <i class="fa fa-crown"></i>
                        Vous êtes administrateur du groupe.
                    </button>
                {% elif is_member %}
                    <button class='btn btn-light btn-sm disabled'>
                        <i class="fa fa-user"></i>
                        Vous êtes déjà membre !
                    </button>
                {% else %}
                    <button id='show-add-group' class='btn btn-dark btn-sm' data-bs-toggle="modal" data-bs-target="#addModal">
                        <i class="fa fa-user-plus"></i>
                        Devenir membre
                    </button>
                {% endif %}
                {% if is_admin %}
                    <a href='{% url "group:update" object.slug %}'class="btn btn-dark btn-sm"><i class="fa fa-pencil"></i> Modifier la page</a>
                {%endif%}
            {% endif %}
            </p>
            <p></p>
            <p>{{object.description}}</p>
            <p></p>
            <div class="grille-rs">
            {% for rs in social %}
                <a href="{{ rs.url }}" target="_blank" class="rs" style="--color-rs: {{ rs.reseau.color }}">
                    <div><i class="fa fa-{{ rs.reseau.icon_name }}"></i></div>
                    <span>{{ rs.reseau.name }}</span>
                </a>
            {% endfor %}
            </div>
        </div>
    </div>
    <br>
    <h2>Événements à venir</h2>
    {% if request.user.is_authenticated %}
        <div class="row">
            {% for event in events %}
                <div class='card'>
                    <div class='card-title'>
                        <h6>{{event.title}}</h6>
                        <small class='text-muted'>
                            <i class="fas fa-calendar-day"></i> 
                            {{event.date|date:'Y-m-d H:i'}}</br>
                            <i class="far fa-compass"></i> 
                            {{event.location}}
                        </small>
                    </div>
                    <div class='card-body'>
                        {{event.description | truncatewords_html:35}}
                    </div>
                </div>
            {% endfor %}
        </div>
    {%else%}
        Veuillez vous connecter pour visualiser les événements à venir.
    {%endif%}
    
    <h2>Dernières annonces</h2>
    {% for post in posts %}
        <a href="{{post.get_absolute_url}}" style='color:white' class="mb-1">
            <div class="card pt-0 bg-{{post.color}}" style="box-shadow: 1px 1px 7px #999">
                <div class="card-body">
                    <h5 class="card-title" >{{post.title}} • {{post.publication_date|date:'d:m'}}</h5>
                    <h6 class="card-subtitle mb-2">{{post.get_group.name}}</h6>
                    <p class="card-text" >{{post.description | truncatewords_html:20}}</p>
                </div>
            </div>
        </a>
        <br \>
    {% endfor %}

    <h2>Membres</h2>
    {% if request.user.is_authenticated %}
        {% for member in members %}
            <a href='{% url "student:detail" member.student.id%}' class='card'>
                {{member.student.user.first_name}} {{member.student.user.last_name}} -
                {{member.function}} - {{member.year}}
            </a>
        {% endfor %}
    {%else%}
        Veuillez vous connecter pour visualiser les membres.
    {%endif%}
    
    <div class="modal fade" id="addModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                {% load crispy_forms_tags %}  
                    <div class="modal-header">
                        <h5 class="modal-title">M'ajouter à {{object.name}}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>        
                    <div class="modal-body">
                        <form method="post" action="{% url 'group:add-member' object.slug %}">
                            {% csrf_token %}      
                            {{form | crispy}}
                            <button type="submit" value="Submit" class="btn btn-dark">M'ajouter</button>
                        </form>
                    </div>
            </div>
        </div>
    </div>
{% endblock %}
