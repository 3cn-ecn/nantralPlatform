{% extends 'base.html' %}
{% load static %}

{% block title %}{{ object.name }} -{% endblock %}

{% block banniere %}
    {% if object.banniere %}
    <div class="ratio ratio-banniere">
        <img class="banniere" src='{{ object.banniere.url }}?{{object.modified_date}}'>
    </div>
    {% endif %}
{% endblock %}

{% block content %}
    <!-- En-tÃªte de la page -->
    <div class="row">
        <!-- logo -->
        {%if object.logo %}
            <div class="col-12 col-md-4 col-xl-3">
                <div class="ratio ratio-1x1">
                    <img class="logo" src='{{object.logo.url}}?{{object.modified_date}}'>
                </div>
            </div>
        {% endif %}
        <!-- description du club : nom, infos... -->
        <div class="col">
            <h1>{{object.name}}</h1>
            <p>
            {% if request.user.is_authenticated %}
                {% if is_member and is_admin %}
                    <button class='btn btn-light btn-sm disabled'>
                        <i class="fa fa-crown"></i>
                        Vous Ãªtes admin du groupe.
                    </button>
                {% elif is_member %}
                    <button class='btn btn-light btn-sm disabled'>
                        <i class="fa fa-user"></i>
                        Vous Ãªtes dÃ©jÃ  membre !
                    </button>
                {% else %}
                    <button id='show-add-group' class='btn btn-dark btn-sm' data-bs-toggle="modal" data-bs-target="#addModal">
                        <i class="fa fa-user-plus"></i>
                        Devenir membre
                    </button>
                {% endif %}
                {% if is_admin %}
                    <a href='{%url group_type|add:":update" group_slug %}' class="btn btn-dark btn-sm"><i class="fa fa-pencil"></i> Modifier la page</a>
                {%endif%}
            {% endif %}
            </p>
            {% if resume %}
                <br>
                <p>{{ object.resume }}</p>
            {% endif %}
            {% include "sociallink/liste.html" with sociallinks=sociallinks%}
        </div>
    </div>

    <!-- Events -->
    {% if events %}
        <br>   
        <h2>Ã‰vÃ¨nements</h2>
        {% if request.user.is_authenticated %}
            <div class="row">
                {% for event in events %}
                    <div class='card'>
                        <div class='card-title'>
                            <h6>{{event.title}}</h6>
                            <small class='text-muted'>
                                <i class="fas fa-calendar-day"></i> 
                                {{event.date|date:'Y-m-d H:i'}}</br>
                                <i class="far fa-compass"></i> 
                                {{event.location}}
                            </small>
                        </div>
                        <div class='card-body'>
                            {{event.description | truncatewords_html:35}}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {%else%}
            <p>Veuillez vous connecter pour voir les Ã©vÃ¨nements Ã  venir.</p>
        {%endif%}
    {% endif %}
    
    <!-- Anonces -->
    {% if posts %}
        <br>
        <h2>Annonces</h2>
        {% for post in posts %}
            <a href="{{post.get_absolute_url}}" style='color:white' class="mb-1">
                <div class="card pt-0 bg-{{post.color}}" style="box-shadow: 1px 1px 7px #999">
                    <div class="card-body">
                        <h5 class="card-title" >{{post.title}} â€¢ {{post.publication_date|date:'d:m'}}</h5>
                        <h6 class="card-subtitle mb-2">{{post.get_group.name}}</h6>
                        <p class="card-text" >{{post.description | truncatewords_html:20}}</p>
                    </div>
                </div>
            </a>
        {% endfor %}
    {% endif %}

    <!-- VidÃ©os s'il y en a 2 -->
    {% if object.video1 and object.video2 %}
        {% load group_tags %}
        <br />
        <h2>VidÃ©os</h2>
        <div class="row gy-3">
            <div class="col-12 col-md-6">
                <div class="ratio ratio-16x9">
                    {% video_embed object.video1 %}
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="ratio ratio-16x9">
                    {% video_embed object.video2 %}
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Description avec vidÃ©o dans le coin s'il y en a une seulement-->
    {% if object.description or object.video1 and not object.video2 %}
        <br>
        <div class="clearfix">
            {% if object.video1 and not object.video2 %}
            <div class="col-md-6 float-md-end mb-3 ms-md-3">
                <div class="ratio ratio-16x9">
                    {% video_embed object.video1 %}
                </div>
            </div>
            {% endif %}
            {% if object.description %}
                {% autoescape off %}
                    {{object.description}}
                {% endautoescape %}
            {% endif %}
        </div>
    {% endif %}

    <!-- Liste des membres -->
    <br />
    <h2>Membres</h2>
    {% if request.user.is_authenticated %}
        {% if members %}
            {% for member in members %}
                <a href='{% url "student:detail" member.student.id%}' class='card'>
                    {{member.student.user.first_name}} {{member.student.user.last_name}} -
                    {{member.function}} - {{member.date_begin}}
                </a>
            {% endfor %}
        {%else%}
            <p>Aucun membre pour l'instant... ðŸ˜¥</p>
        {%endif%}
    {% else %}
        <p>Veuillez vous connecter pour voir les membres.</p>
    {% endif %}

    {# Ajout possible de contenus pour certaines pages #}
    {% block extra-content %}
    {% endblock %}

    {# Bouton pour faire une demande pour devenir admin #}
    {% block admin-req %}
        {% if is_member and not is_admin %}
            {% include 'group/detail/request-admin.html' %}
        {%endif%}
    {% endblock %}

    {# popup pour devenir membre du groupe #}
    {% block add-member %}
        {% include 'group/detail/add-member.html' %}
    {% endblock%}

    <br>
{% endblock %}
